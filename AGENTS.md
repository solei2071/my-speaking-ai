# AGENTS.md (Project Playbook)

이 저장소는 **my-speaking-ai**입니다.  
Claude Code / 여러 AI 에이전트가 동시에 작업하더라도 일관된 방식으로 수정이 이어지도록 하는 운영 규칙입니다.

---

## 1) 프로젝트 목표
- 제품 출시 품질 우선: 기능 정확성, 사용성, 접근성, 성능의 균형.
- 회귀 위험이 큰 기능(실시간 음성/채팅/세션 요약/저장/로그인)을 안정적으로 유지.
- 실험용 변경보다 사용자가 체감할 UX 완성도를 우선.

---

## 2) 작업 우선순위
1. `AGENTS.md`
2. 기존 코드의 주변 문맥(해당 파일 주변 패턴, 기존 함수/스타일)
3. 사용자 요청(당일 우선사항)
4. 신규 제안(실험/리팩터)

우선순위 충돌 시 반드시 사용자에게 사전 확인 후 진행.

---

## 3) 폴더/책임 경계
- `src/routes/+page.svelte`  
  - 핵심 세션 상태, 연결/해제, 메시지 처리, 요약 리포트 UI 담당.
  - 큰 구조 변경은 요청 기반으로 최소 범위 수정.
- `src/routes/layout.css`  
  - 앱 전역 톤/그라디언트/카드/모션.
  - 페이지별 인라인 스타일보다 공통 디자인은 여기에.
- `src/lib/*`  
  - 공통 로직 분리(저장, 분석, 캐릭터/시나리오 데이터, 인증, 통계).
  - 페이지 로직 의존도를 줄이는 쪽으로만 수정.

---

## 4) 코드 작성 규칙
- Svelte 5 rune (`$state`, `$derived`, `$effect`) 사용 패턴 유지.
- 기본 포맷은 기존과 동일하게 유지(2-space indentation / 기존 정렬 스타일).
- 새 변수/함수는 의미 있는 이름 + 주석은 **필요한 핵심 설명만**.
- 하드코딩 가능한 값은 상수화.
- 문자열은 UTF-8 그대로, 한국어 사용자 메시지는 사용자 대상 문구 유지.
- 브라우저 호환성: Web Speech 미지원 분기(`speechRecognitionSupported`)는 기존 플로우 유지.

### 위험한 변경 지양
- DB 스키마/저장 스키마 임의 변경 금지.
- 로그인/세션/연결 상태 플로우를 뒤집는 변경은 신중히.
- 점수 산정식 변경 시 의미 및 범위를 같이 문서화.

---

## 5) 세션 요약 지표(현재 기준)
작업 중인 지표는 아래 항목 기준으로 일관되게 처리.
- 질문 수: AI 메시지(`role === 'assistant'`) 내 `?` 개수 합산
- 답변 수: 사용자 메시지(`role === 'user'`) 개수
- 발화 단어: 사용자 메시지 단어 수
- 대화 시간: `sessionStartedAt` ~ `sessionEndedAt`
- WPM: `단어수 / duration_ms * 60000`
- 명확도: 발음 점수 평균(없으면 기본값 규칙 적용)

요약 UI는 기존 스펙을 무너뜨리지 않고, 점수/인사이트를 보완하는 방식으로만 추가.

---

## 6) 디자인 규칙 (시각 일관성)
- 핵심 화면에 과도한 보라/플랫 단색 남발 금지.
- 카드/패널은 `market-*` 계열 디자인 토큰 계열 유지(가능하면 공용 클래스 활용).
- 배경은 단색보다 그라디언트/미묘한 레이어 강조.
- 모션은 의미 있는 전환(입장/강조) 위주, 과도한 흔들림/무한 애니메이션 최소화.

---

## 7) 테스트/검증 기본 루틴
작업 완료 전 실행:
- `npm run lint`
- `npm run build`

실패 시:
- 에러 원인만 제시하지 말고, 어떤 파일에서 어떤 라인이 깨졌는지 포함해 바로 수정.

---

## 8) Claude Code(멀티 에이전트) 운영 규칙
- 큰 변경 전, 다음 3가지를 먼저 확인:  
  1) 현재 상태(`status`)와 세션/연결 플로우에 영향 있는지  
  2) 저장/분석/표시 로직과 충돌 여부  
  3) 빌드·린트 통과 가능성
- 서로 다른 에이전트의 제안이 충돌하면: 최신 변경이 아닌 **의도/근거 우선 비교**.
- 실험성 변경은 `주석 또는 로그`에 분명히 표시하고, 기본 동작은 유지.

---

## 9) 커뮤니케이션 규칙
- 사용자에게 결과를 말할 때:
  1) 변경 요약 (무엇이 바뀜)  
  2) 왜 바뀜 (왜 이 방식)  
  3) 검증 상태(린트/빌드)  
  4) 다음 추천 액션

---

## 10) 금지 / 주의
- 불필요한 삭제/강제 되돌리기(`git reset --hard`, `git checkout --`) 금지.
- 외부 규칙과 충돌 시 사용자에게 즉시 알리고 재확인 요청.
- 프로젝트 전체를 임의로 리프레시하는 방식보다, 영향 범위 최소화로 패치.

